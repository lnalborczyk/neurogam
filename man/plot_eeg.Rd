% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_eeg.R
\name{plot_eeg}
\alias{plot_eeg}
\title{Plot spatio-temporal EEG data as topographies or 2D surfaces}
\usage{
plot_eeg(
  x,
  type = c("topo", "surface"),
  times = NULL,
  n_times = NULL,
  sensors = NULL,
  value_col = "voltage",
  time_col = "time",
  x_col = "xproj",
  y_col = "yproj",
  grid_res = 100,
  head_expand = 1.1,
  re_formula = NULL,
  probs = c(0.025, 0.975),
  ndraws = NULL,
  show_sensors = TRUE,
  sensor_size = 1.5,
  sensor_labels = FALSE,
  sensor_label_col = "channel",
  sensor_label_size = 3,
  sensor_label_repel = TRUE,
  contours = TRUE,
  contour_bins = 10,
  palette = "RdBu",
  facet_nrow = NULL,
  facet_ncol = NULL,
  facet_scales = "fixed",
  facet_label_prefix = "Time: ",
  facet_unit = "s",
  fill_limits = c("global_quantile", "global", "none"),
  limit_quantiles = c(0.01, 0.99)
)
}
\arguments{
\item{x}{Either a data frame containing EEG data (raw or summarised) or a
fitted \code{brmsfit} object. If a data frame is provided, it must contain
columns specified by \code{time_col}, \code{x_col}, \code{y_col}, and
\code{value_col}. If a \code{brmsfit} is provided, predictions are computed
from \code{x$data} and \code{x} must include a compatible spatio-temporal
smooth (e.g., \code{gp(time, xproj, yproj, ...)} or \code{t2(time, xproj, yproj, ...)}).}

\item{type}{Character; plot type. \code{"topo"} draws a scalp outline and masks
values outside the head. \code{"surface"} draws only the interpolated/predicted
field.}

\item{times}{Numeric vector of time points to plot. If \code{NULL}, all unique
times found in the input are used (or a subset if \code{n_times} is provided).}

\item{n_times}{Optional integer; if not \code{NULL}, selects \code{n_times}
approximately equally spaced time points from \code{times}.}

\item{sensors}{Optional data frame of sensor positions used to draw the head
outline, sensor points, and sensor labels. Must contain columns \code{xproj}
and \code{yproj}. If \code{NULL}, sensor coordinates are inferred from the
unique \code{x_col}/\code{y_col} pairs in \code{x} (labels will then be unavailable).}

\item{value_col}{Character; name of the value column in raw data (e.g., \code{"voltage"}).}

\item{time_col, x_col, y_col}{Character; column names in \code{x} giving time and 2D sensor
coordinates (projected).}

\item{grid_res}{Integer; grid resolution used to evaluate predictions and/or
interpolate data to a regular grid (approximately \code{grid_res^2} pixels per facet).}

\item{head_expand}{Numeric; expansion factor used to compute the head radius
from sensor coordinates (values > 1 add padding).}

\item{re_formula}{Passed to \code{\link[brms:fitted.brmsfit]{brms::fitted}} when \code{x}
is a \code{brmsfit}. Use \code{NULL} for default behaviour, or \code{NA} to exclude
group-level terms.}

\item{probs}{Numeric vector of length 2 giving the quantiles returned by
\code{brms::fitted(..., probs = probs)}.}

\item{ndraws}{Optional integer; number of posterior draws used by \code{brms::fitted}.}

\item{show_sensors}{Logical; if \code{TRUE} and \code{type = "topo"}, plot sensor points.}

\item{sensor_size}{Numeric; point size for sensors.}

\item{sensor_labels}{Logical; if \code{TRUE}, add sensor labels (requires \code{sensors}
to contain \code{sensor_label_col}).}

\item{sensor_label_col}{Character; column name in \code{sensors} providing sensor names.}

\item{sensor_label_size}{Numeric; text size for sensor labels.}

\item{sensor_label_repel}{Logical; if \code{TRUE}, use \pkg{ggrepel} for labels.}

\item{contours}{Logical; if \code{TRUE}, add contour lines.}

\item{contour_bins}{Integer; number of contour bins.}

\item{palette}{Character; palette name passed to \code{\link[ggplot2]{scale_fill_distiller}}.}

\item{facet_nrow, facet_ncol}{Integers; layout for \code{\link[ggplot2]{facet_wrap}}.}

\item{facet_scales}{Character; facet scaling, passed to \code{facet_wrap(scales = ...)}.}

\item{facet_label_prefix}{Character; prefix used when generating facet labels (e.g., \code{"Time: "}).}

\item{facet_unit}{Character; unit suffix used when generating facet labels (e.g., \code{"s"}).}

\item{fill_limits}{Character; how to set colour scale limits.
\code{"global_quantile"} uses \code{limit_quantiles} to define robust symmetric limits,
\code{"global"} uses the full range, and \code{"none"} leaves limits to ggplot.}

\item{limit_quantiles}{Numeric vector of length 2; quantiles used when
\code{fill_limits = "global_quantile"}.}
}
\value{
A \code{ggplot} object.
}
\description{
Create facetted EEG maps across multiple time points from either
i) a \pkg{brms} spatio-temporal model (predicted values) or
ii) raw/summarised EEG data in long format (observed values).
}
\details{
The function can render either a scalp topography (\code{type = "topo"})
with a head outline and optional sensor markers/labels, or a simple 2D
surface plot (\code{type = "surface"}) without a head outline.


For \code{type = "topo"}, values are masked outside the head radius computed from
sensor coordinates and a head outline (circle + nose + ears) is drawn.

For raw data, values are interpolated to a regular grid per time point using
\code{st_interp_to_grid()}, which relies on \pkg{akima} and can optionally fill
missing grid cells using nearest-neighbour (\pkg{FNN}).

For \code{brmsfit} inputs, predictions are obtained via \code{brms::fitted()} on a
regular grid. When \code{type = "topo"}, missing values inside the head can be
filled using \code{st_fill_head()} (nearest-neighbour).

This function relies on internal helpers such as \code{st_take_n_times()},
\code{st_make_grid()}, \code{st_head_radius()}, \code{st_head_outline()},
\code{st_build_time_labels()}, \code{st_order_time_factor()},
\code{st_compute_limits()}, \code{st_predict_brms()}, \code{st_fill_head()},
and \code{st_interp_to_grid()}.
}
\examples{
\dontrun{
# Summarised EEG data (long format)
plot_eeg(
  eeg_data_summary,
  type = "topo",
  sensors = sensors,
  times = c(0, 0.1, 0.2, 0.3),
  grid_res = 80,
  contours = FALSE,
  facet_nrow = 2
  )

# brms model predictions
plot_eeg(
  spatio_temporal_gam,
  type = "topo",
  sensors = sensors,
  times = c(0, 0.1, 0.2, 0.3),
  ndraws = 200
  )
}

}
\author{
Ladislas Nalborczyk \email{ladislas.nalborczyk@cnrs.fr}
}
