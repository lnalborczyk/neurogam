% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/check_residual_autocorrelation.R
\name{check_residual_autocorrelation}
\alias{check_residual_autocorrelation}
\title{Check and visualise residual autocorrelation in a fitted \pkg{brms} model}
\usage{
check_residual_autocorrelation(
  fit,
  data = NULL,
  time_id = "time",
  series_id = "ar_series",
  participant_id = "participant",
  predictor_id = "predictor",
  outcome_mean_id = "outcome_mean",
  success_id = "success",
  trials_id = "trials",
  max_lag = 25,
  n_series_plot = 9,
  seed = 42,
  use_posterior_mean = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{fit}{A fitted \code{\link[brms:brm]{brmsfit}} object.}

\item{data}{A data frame used to fit the model (or the same rows in the same order).
Must contain a time column and (directly or indirectly) an AR series identifier.}

\item{time_id}{Character; name of the time column. Defaults to \code{"time"}.}

\item{series_id}{Character; name of the column defining independent time series
for autocorrelation checks. Defaults to \code{"ar_series"}.
If \code{series_id} is not present in \code{data}, it is created as
\code{interaction(participant_id, predictor_id, drop = TRUE)} when possible,
otherwise as \code{participant_id}.}

\item{participant_id}{Character; participant column name used to build \code{series}
if needed. Defaults to \code{"participant"}.}

\item{predictor_id}{Character; predictor/condition column name used to build \code{series}
if needed. Defaults to \code{"predictor"}.}

\item{outcome_mean_id}{Character; outcome column for Gaussian-type residuals.
Defaults to \code{"outcome_mean"}.}

\item{success_id, trials_id}{Character; columns for binomial outcomes
(\code{success} and \code{trials}). Defaults to \code{"success"} and \code{"trials"}.}

\item{max_lag}{Integer; maximum lag for ACF curves. Defaults to 25.}

\item{n_series_plot}{Integer; number of series to plot ACFs for (sampled).
Defaults to 9.}

\item{seed}{Integer or \code{NULL}; random seed for sampling series to plot.
Defaults to 42.}

\item{use_posterior_mean}{Logical; if \code{TRUE} (default) uses posterior mean
\code{E[y|x]} to compute residuals. If \code{FALSE}, uses median.}

\item{verbose}{Logical; if \code{TRUE}, emits informative messages and warnings.}
}
\value{
A named list with components:
\describe{
  \item{data}{A copy of \code{data} with \code{.series} and \code{.resid} columns added.}
  \item{checks}{A list of checks (duplicates, missing columns, etc.).}
  \item{ar_summary}{A data frame summarising AR parameter draws (if present).}
  \item{rho1_by_series}{A data frame with lag-1 residual correlation per series.}
  \item{acf_df}{A data frame of ACF values for sampled series (for plotting).}
  \item{plots}{A list of \pkg{ggplot2} objects.}
}
}
\description{
Computes practical diagnostics for residual autocorrelation in a fitted
\pkg{brms} model, with special handling of time-resolved neurogam data where
each participant can have multiple independent time series (e.g., one per
condition).
}
\details{
The function:
\itemize{
  \item checks that time points are unique within each AR series,
  \item extracts and summarises AR parameter(s) (e.g., \code{ar[1]}) if present,
  \item computes posterior-mean residuals \eqn{y - E[y \mid x]},
  \item quantifies lag-1 residual autocorrelation per series,
  \item visualises residual autocorrelation via ACF curves and summary plots.
}
}
\examples{
\dontrun{
# after fitting a brms model
out <- check_residual_autocorrelation(fit)
out$ar_summary
out$plots$rho1_hist
out$plots$acf
}

}
\author{
Ladislas Nalborczyk \email{ladislas.nalborczyk@cnrs.fr}.
}
