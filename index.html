<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Modelling time-resolved electrophysiological data with Bayesian generalised additive multilevel models • neurogam</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Modelling time-resolved electrophysiological data with Bayesian generalised additive multilevel models">
<meta name="description" content="Providing utility functions for fitting Bayesian generalised additive multilevel models (BGAMMs) to time-resolved data (e.g., M/EEG, pupillometry, mouse-tracking, etc) and identifying clusters.">
<meta property="og:description" content="Providing utility functions for fitting Bayesian generalised additive multilevel models (BGAMMs) to time-resolved data (e.g., M/EEG, pupillometry, mouse-tracking, etc) and identifying clusters.">
<meta property="og:image" content="https://lnalborczyk.github.io/neurogam/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">neurogam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lnalborczyk/neurogam/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="modelling-time-resolved-electrophysiological-data-with-bayesian-generalised-additive-multilevel-models-">Modelling time-resolved electrophysiological data with Bayesian generalised additive multilevel models 
<a class="anchor" aria-label="anchor" href="#modelling-time-resolved-electrophysiological-data-with-bayesian-generalised-additive-multilevel-models-"></a>
</h1>
</div>
<p>The goal of <code>neurogam</code> is to provide utilities for estimating the onset and offset of time-resolved effects, such as those found in M/EEG, pupillometry, or finger/mouse-tracking data (amongst others). The current version only allows fitting 1D temporal data (e.g., raw M/EEG data or decoding timecourses) but will be extended in the near future to support 2D temporal or spatiotemporal data.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>neurogam</code> from GitHub with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span></span>
<span>    repo <span class="op">=</span> <span class="st">"https://github.com/lnalborczyk/neurogam"</span>,</span>
<span>    dependencies <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level3">
<h3 id="model-fitting">Model fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h3>
<p>Below we fit a Bayesian generalised additive multilevel model (BGAMM) to estimate the onset and offset of a difference between conditions (in simulated EEG data). Note that we recommend fitting the BGAMM on time-resolved summary statistics (mean and SD) as the full (i.e., trial-by-trial) BGAMM may be too slow, and the group-level BGAM (i.e., no random/varying effect) may provide too liberal cluster estimates.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loading the neurogam package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lnalborczyk/neurogam" class="external-link">neurogam</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># importing some simulated EEG data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">eeg_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># displaying some rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">eeg_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;      participant condition trial  time       eeg</span></span>
<span><span class="co">#&gt; 1 participant_01     cond1     1 0.000 0.8618045</span></span>
<span><span class="co">#&gt; 2 participant_01     cond1     1 0.002 1.2729148</span></span>
<span><span class="co">#&gt; 3 participant_01     cond1     1 0.004 1.6538158</span></span>
<span><span class="co">#&gt; 4 participant_01     cond1     1 0.006 1.3910888</span></span>
<span><span class="co">#&gt; 5 participant_01     cond1     1 0.008 0.6499553</span></span>
<span><span class="co">#&gt; 6 participant_01     cond1     1 0.010 0.1548358</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fitting the BGAMM to identify clusters</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/testing_through_time.html">testing_through_time</a></span><span class="op">(</span></span>
<span>    <span class="co"># simulated EEG data</span></span>
<span>    data <span class="op">=</span> <span class="va">eeg_data</span>,</span>
<span>    <span class="co"># name of predictor in data</span></span>
<span>    <span class="co"># predictor_id = "condition",</span></span>
<span>    <span class="co"># when predictor_id = NA, tests average level against 0</span></span>
<span>    predictor_id <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    <span class="co"># we recommend fitting the GAMM with summary statistics (mean and SD)</span></span>
<span>    multilevel <span class="op">=</span> <span class="st">"summary"</span>,</span>
<span>    <span class="co"># threshold on posterior odds</span></span>
<span>    threshold <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    <span class="co"># number of iterations (per MCMC)</span></span>
<span>    iter <span class="op">=</span> <span class="fl">5000</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualising-the-results">Visualising the results<a class="anchor" aria-label="anchor" href="#visualising-the-results"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># displaying the identified clusters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ==== Time-resolved Bayesian GAMM Results ======================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Clusters found: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  cluster_id cluster_onset cluster_offset duration</span></span>
<span><span class="co">#&gt;           1         0.162          0.348    0.186</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; =================================================================</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plotting the data, model's predictions, and clusters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-fig-clusters-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="posterior-predictive-checks">Posterior predictive checks<a class="anchor" aria-label="anchor" href="#posterior-predictive-checks"></a>
</h3>
<p>We recommend visually assessing the predictions of the model against the observed data. We provide the <code><a href="reference/ppc.html">ppc()</a></code> method, but you can conduct your own custom PPCs with <code>brms::pp_check(results$model, ...)</code> (for all available PPCs, see <a href="https://mc-stan.org/bayesplot/reference/PPC-overview.html" class="external-link uri">https://mc-stan.org/bayesplot/reference/PPC-overview.html</a>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># posterior predictive checks (PPCs)</span></span>
<span><span class="fu"><a href="reference/ppc.html">ppc</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-fig-ppc-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="how-to-define-the-basis-dimension">How to define the basis dimension?<a class="anchor" aria-label="anchor" href="#how-to-define-the-basis-dimension"></a>
</h3>
<p>There is no universal recommendation for choosing the optimal value of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>, as it depends on several factors, including the sampling rate, preprocessing steps (e.g., signal-to-noise ratio, low-pass filtering), and the underlying temporal dynamics of the effect of interest. One strategy is to set <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> as high as computational constraints allow (acknowledging that the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-value only provides an upper bound on the <em>effective</em> basis dimension). Alternatively, one can fit a series of models with different <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> values and compare these models using information criteria such as LOOIC or WAIC, alongside with posterior predictive checks (PPCs), to select the model that best captures the structure of the data. We illustrate this approach below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># recommend an optimal smooth basis dimension k</span></span>
<span><span class="va">k_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/recommend_k.html">recommend_k</a></span><span class="op">(</span></span>
<span>    object <span class="op">=</span> <span class="va">results</span>,</span>
<span>    k_min <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    k_max <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    k_step <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    criterion <span class="op">=</span> <span class="st">"waic"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-fig-reco-k-1.png" width="100%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># results summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">k_res</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ==== Summary of k recommendation ===================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of models fitted  : 7</span></span>
<span><span class="co">#&gt; k values tested          : 10, 15, 20, 25, 30, 35, 40</span></span>
<span><span class="co">#&gt; Range of k values        : [10, 40]</span></span>
<span><span class="co">#&gt; Knee based on            : p_waic</span></span>
<span><span class="co">#&gt; Recommended k (knee)     : 20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Comparison table (rounded):</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   k   model waic_elpd waic_elpd_se p_waic p_waic_se     waic p_waic_smooth</span></span>
<span><span class="co">#&gt;  10 gam_k10 -4702.775        5.397  0.116     0.002 9405.549         0.116</span></span>
<span><span class="co">#&gt;  15 gam_k15 -4703.098        5.397  0.124     0.002 9406.196         0.124</span></span>
<span><span class="co">#&gt;  20 gam_k20 -4703.206        5.397  0.126     0.002 9406.411         0.126</span></span>
<span><span class="co">#&gt;  25 gam_k25 -4703.276        5.397  0.127     0.003 9406.552         0.127</span></span>
<span><span class="co">#&gt;  30 gam_k30 -4703.279        5.397  0.128     0.003 9406.559         0.128</span></span>
<span><span class="co">#&gt;  35 gam_k35 -4703.296        5.397  0.128     0.003 9406.591         0.128</span></span>
<span><span class="co">#&gt;  40 gam_k40 -4703.303        5.397  0.128     0.003 9406.606         0.128</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ====================================================================</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>When using <code>neurogam</code>, please cite the following publication:</p>
<ul>
<li>Nalborczyk, L., &amp; Bürkner, P. (2025). Precise temporal localisation of M/EEG effects with Bayesian generalised additive multilevel models. <em>biorXiv</em>. Preprint available at: <a href="https://doi.org/10.1101/2025.08.29.672336" class="external-link uri">https://doi.org/10.1101/2025.08.29.672336</a>.</li>
</ul>
<p>As <code>neurogam</code> is an interface to the <code>brms</code> package, please additionally cite one or more of the following publications:</p>
<ul>
<li>Bürkner P. C. (2017). brms: An R Package for Bayesian Multilevel Models using Stan. Journal of Statistical Software. 80(1), 1-28. doi.org/10.18637/jss.v080.i01</li>
<li>Bürkner P. C. (2018). Advanced Bayesian Multilevel Modeling with the R Package brms. The R Journal. 10(1), 395-411. doi.org/10.32614/RJ-2018-017</li>
<li>Bürkner P. C. (2021). Bayesian Item Response Modeling in R with brms and Stan. Journal of Statistical Software, 100(5), 1-54. doi.org/10.18637/jss.v100.i05</li>
</ul>
</div>
<div class="section level2">
<h2 id="getting-help">Getting help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<p>If you encounter a bug or have a question please file an issue with a minimal reproducible example on <a href="https://github.com/lnalborczyk/neurogam/issues" class="external-link">GitHub</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/lnalborczyk/neurogam/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/lnalborczyk/neurogam/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing neurogam</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Ladislas Nalborczyk <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-7419-9855" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ladislas Nalborczyk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
